<!DOCTYPE html>
<html lang="es" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Finanzas - Google Sheets</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.10/dayjs.min.js"></script>
  <style>
    body { background: linear-gradient(135deg, #667eea 0%, #667eea 0%, #764ba2 100%); }
  </style>
</head>
<body class="dark">
  <div class="container mx-auto max-w-4xl p-4 pb-24">
    <header class="flex justify-between items-center mb-6">
      <h1 class="text-3xl font-bold text-white mb-6">Finanzas</h1>
    </header>

    <!-- Resumen -->
    <div class="mb-6">
      <h2 class="text-xl font-bold text-white mb-4">Resumen</h2>
      <div class="grid grid-cols-3 gap-4">
        <div class="bg-white rounded-lg p-6 shadow">
          <p class="text-gray-600 font-semibold">Balance Hoy</p>
          <p id="balanceToday" class="text-3xl font-bold text-blue-600">$0.00</p>
        </div>
        <div class="bg-white rounded-lg p-6 shadow">
          <p class="text-gray-600 font-semibold">Balance Mes</p>
          <p id="balanceMonth" class="text-3xl font-bold text-blue-600">$0.00</p>
        </div>
        <div class="bg-white rounded-lg p-6 shadow">
          <p class="text-gray-600 font-semibold">Proyección</p>
          <p id="projection" class="text-3xl font-bold text-blue-600">$0.00</p>
        </div>
      </div>
    </div>

    <!-- Form -->
    <div class="bg-white rounded-lg p-6 shadow mb-6">
      <h2 class="text-xl font-bold mb-4">Agregar Movimiento</h2>
      <form id="movementForm" class="space-y-4">
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700">Tipo</label>
            <select id="type" class="w-full px-3 py-2 border border-gray-300 rounded-md" required>
              <option value="Ingreso">Ingreso</option>
              <option value="Egreso">Egreso</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700">Monto</label>
            <input type="number" id="amount" placeholder="0.00" step="0.01" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-md" required>
          </div>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Nota (opcional)</label>
          <input type="text" id="note" placeholder="Añade una nota..." class="w-full px-3 py-2 border border-gray-300 rounded-md">
        </div>
        <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md font-semibold hover:bg-blue-700">Agregar Movimiento</button>
      </form>
    </div>

    <!-- Movimientos -->
    <div class="bg-white rounded-lg p-6 shadow">
      <h2 class="text-xl font-bold mb-4">Movimientos de Hoy</h2>
      <div id="movements" class="space-y-2"></div>
    </div>
  </div>

  <script>
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbykAnKFEPjjKhs7FtMWVkSY5gp66cQV2quXigZejqj5vHT1U4AlWPVN3B6WVc4q9P7pfg/usercontent'; // Cambiar URL si es necesario
    const APPS_SCRIPT_EXEC_URL = 'https://script.google.com/macros/s/AKfycbykAnKFEPjjKhs7FtMWVkSY5gp66cQV2quXigZejqj5vHT1U4AlWPVN3B6WVc4q9P7pfg/exec';
    
    let movements = [];

    function formatCurrency(amount) {
      return new Intl.NumberFormat('es-AR', { style: 'currency', currency: 'ARS' }).format(amount);
    }

    function saveMovement(data) {
      // Send to Apps Script
      fetch(APPS_SCRIPT_EXEC_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      }).then(response => {
        console.log('Movimiento enviado al servidor:', data);
      }).catch(error => {
        console.error('Error al enviar:', error);
      });
    }

    function render() {
      const today = dayjs().format('YYYY-MM-DD');
      const todayMovements = movements.filter(m => m.date === today);
      const balance = todayMovements.reduce((acc, m) => {
        return m.type === 'Ingreso' ? acc + m.amount : acc - m.amount;
      }, 0);

      document.getElementById('balanceToday').textContent = formatCurrency(balance);
      document.getElementById('balanceMonth').textContent = '$0.00';
      document.getElementById('projection').textContent = '$0.00';

      const movementsHTML = todayMovements.map(m => {
        const sign = m.type === 'Ingreso' ? '+' : '-';
        const color = m.type === 'Ingreso' ? 'text-green-600' : 'text-red-600';
        return `
          <div class="flex justify-between items-start p-4 bg-gray-50 rounded-lg">
            <div>
              <p class="font-semibold capitalize">${m.type}</p>
              <p class="text-sm text-gray-600">${m.note || 'Sin nota'}</p>
            </div>
            <p class="font-semibold ${color}">${sign}${formatCurrency(m.amount)}</p>
          </div>
        `;
      }).join('');

      document.getElementById('movements').innerHTML = movementsHTML || '<p class="text-gray-500">No hay movimientos hoy</p>';
    }

    document.getElementById('movementForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const type = document.getElementById('type').value;
      const amount = parseFloat(document.getElementById('amount').value);
      const note = document.getElementById('note').value;
      const fecha = dayjs().format('DD/MM/YYYY');
      const date = dayjs().format('YYYY-MM-DD');

      if (amount <= 0) {
        alert('El monto debe ser mayor a 0');
        return;
      }

      const movement = { type, amount, note, fecha, date };
      movements.push(movement);

      // Save to server
      saveMovement(movement);

      // Reset form
      this.reset();
      render();
    });

    // Initial render
    render();
  </script>
</body>
</html>
